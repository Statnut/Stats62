<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Hockey Stat Sheet</title>

<style>
body { font-family: system-ui; margin:0 }
nav { display:flex; background:#111; color:white }
nav button { flex:1; padding:12px; border:none; background:none; color:white }
nav button.active { background:#333 }
section { display:none; padding:12px }
section.active { display:block }
input, select, button, textarea { margin:4px 0; padding:6px }
.log { border-top:1px solid #ccc; margin-top:10px; padding-top:10px }
.scoreline { font-size:18px; margin:8px 0 }
textarea { width:100%; min-height:60px }
.locked { opacity:.6; pointer-events:none }
</style>
</head>

<body>

<nav>
  <button data-tab="game" class="active">Game</button>
  <button data-tab="box">Box Score</button>
</nav>

<section id="game" class="active">
  <h3 id="gameStatus"></h3>

  <div class="scoreline">
    Score: <span id="scoreAway">0</span> – <span id="scoreHome">0</span><br>
    Shots: <span id="shotsAway">0</span> – <span id="shotsHome">0</span>
  </div>

  <h2 id="clock">20:00</h2>
  <button id="clockToggle">Start / Stop</button>
  <button id="advancePeriod">Advance Period</button>
  <button id="endGame">End Game</button>

  <h3>Notes</h3>
  <textarea id="gameNotes"></textarea>

  <div class="log" id="eventLog"></div>
</section>

<section id="box">
  <h3>Final Score</h3>
  <div id="finalScore"></div>

  <h3>Notes</h3>
  <div id="boxNotes"></div>

  <button id="finalizeBox">Finalize Box Score</button>
</section>

<script>
const $ = id => document.getElementById(id);
const SAVE_KEY = "activeGame";

/* ---------------- STATE ---------------- */
let state = {
  game: {
    home:"Home",
    away:"Away",
    score:{home:0,away:0},
    shots:{home:0,away:0},
    period:1,
    status:"REG",
    isFinal:false,
    notes:"",
    log:[]
  },
  clock:{ seconds:1200, running:false, timer:null }
};

/* ---------------- AUTO SAVE ---------------- */
function saveGame(){
  localStorage.setItem(SAVE_KEY, JSON.stringify(state));
}
function loadGame(){
  const raw = localStorage.getItem(SAVE_KEY);
  if(!raw) return;
  state = JSON.parse(raw);
  restoreUI();
}

/* ---------------- UI ---------------- */
document.querySelectorAll("nav button").forEach(b=>{
  b.onclick=()=>{
    document.querySelectorAll("nav button").forEach(x=>x.classList.remove("active"));
    document.querySelectorAll("section").forEach(s=>s.classList.remove("active"));
    b.classList.add("active");
    $(b.dataset.tab).classList.add("active");
  };
});

/* ---------------- CLOCK ---------------- */
function renderClock(){
  const m = String(Math.floor(state.clock.seconds/60)).padStart(2,"0");
  const s = String(state.clock.seconds%60).padStart(2,"0");
  clock.textContent = `${m}:${s}`;
}
clockToggle.onclick=()=>{
  if(state.game.isFinal) return;
  state.clock.running = !state.clock.running;
  if(state.clock.running){
    state.clock.timer = setInterval(()=>{
      if(state.clock.seconds>0){
        state.clock.seconds--;
        renderClock();
        saveGame();
      }
    },1000);
  } else {
    clearInterval(state.clock.timer);
  }
};

/* ---------------- GAME FLOW ---------------- */
advancePeriod.onclick=()=>{
  if(state.game.isFinal) return;

  if(state.game.period===3){
    if(state.game.score.home!==state.game.score.away){
      endGameNow();
      return;
    }
    state.game.period="OT";
    state.clock.seconds=300;
  } else if(state.game.period==="OT"){
    // allow tie or shootout later
    endGameNow();
    return;
  }
  renderStatus();
  renderClock();
  saveGame();
};

endGame.onclick=()=>{
  if(state.game.isFinal) return;
  endGameNow();
};

function endGameNow(){
  state.game.isFinal=true;
  state.game.status="FINAL";
  clearInterval(state.clock.timer);
  renderStatus();
  saveGame();
}

/* ---------------- NOTES ---------------- */
gameNotes.oninput=()=>{
  state.game.notes = gameNotes.value;
  saveGame();
};

/* ---------------- RENDER ---------------- */
function renderStatus(){
  gameStatus.textContent =
    state.game.status==="FINAL"
    ? "FINAL"
    : state.game.period==="OT"
      ? "Overtime"
      : `Period ${state.game.period}`;
}

function renderScore(){
  scoreHome.textContent = state.game.score.home;
  scoreAway.textContent = state.game.score.away;
  shotsHome.textContent = state.game.shots.home;
  shotsAway.textContent = state.game.shots.away;
}

function restoreUI(){
  renderClock();
  renderScore();
  renderStatus();
  gameNotes.value = state.game.notes;
  eventLog.innerHTML = state.game.log.join("<br>");

  if(state.game.isFinal){
    document.getElementById("game").classList.add("locked");
    finalScore.textContent =
      `${state.game.away} ${state.game.score.away} – ${state.game.home} ${state.game.score.home}`;
    boxNotes.textContent = state.game.notes || "—";
  }
}

/* ---------------- BOX SCORE ---------------- */
finalizeBox.onclick=()=>{
  if(state.game.isFinal){
    alert("Box score finalized.");
  }
};

/* ---------------- INIT ---------------- */
loadGame();
renderClock();
renderScore();
renderStatus();
</script>

</body>
</html>